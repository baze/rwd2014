webshims.register("form-datalist-lazy",function(e,t,n,r,i,s){var o=0,u=e.webshims.cfg.forms,a={},f=function(e){if(!e)return[];if(a[e])return a[e];var t;try{t=JSON.parse(localStorage.getItem("storedDatalistOptions"+e))}catch(n){}return a[e]=t||[],t||[]},l=function(e,t){if(e){t=t||[];try{localStorage.setItem("storedDatalistOptions"+e,JSON.stringify(t))}catch(n){}}},c=/</g,h=/>/g;e.extend(s.shadowListProto,{_lazyCreate:function(r){var o=this;this.hideList=e.proxy(o,"hideList"),this.popover=t.objectCreate(t.wsPopover,{},s.datalistPopover),this.shadowList=this.popover.element.addClass("datalist-polyfill"),this.index=-1,this.input=r.input,this.arrayOptions=[],this.shadowList.delegate("li","mouseenter.datalistWidget mousedown.datalistWidget click.datalistWidget",function(t){var n=e("li:not(.hidden-item)",o.shadowList),i="mousedown"==t.type||"click"==t.type;return o.markItem(n.index(t.currentTarget),i,n),"click"==t.type&&(o.hideList(),u.customDatalist&&e(r.input).getNativeElement().trigger("datalistselect")),"mousedown"!=t.type}),r.input.setAttribute("autocomplete","off"),e(r.input).attr({"aria-haspopup":"true"}).on({"input.datalistWidget":function(){o.triggeredByDatalist||(o.changedValue=!1,o.showHideOptions())},"keydown.datalistWidget":function(t){var n,s,a=t.keyCode;return 40!=a||o.showList()?o.popover.isVisible?38==a?(o.markItem(o.index-1,!0),!1):t.shiftKey||33!=a&&36!=a?t.shiftKey||34!=a&&35!=a?(13==a||27==a)&&(13==a&&(n=e("li.active-item:not(.hidden-item)",o.shadowList),o.changeValue(e("li.active-item:not(.hidden-item)",o.shadowList))),o.hideList(),u.customDatalist&&n&&n[0]&&e(r.input).getNativeElement().trigger("datalistselect"),13!=t.keyCode||n&&n[0])?!1:i:(s=e("li:not(.hidden-item)",o.shadowList),o.markItem(s.length-1,!0,s),!1):(o.markItem(0,!0),!1):i:(o.markItem(o.index+1,!0),!1)},"focus.datalistWidget":function(){e(this).hasClass("list-focus")&&o.showList()},"mousedown.datalistWidget":function(){e(this).is(":focus")&&o.showList()}}),e(this.datalist).off("updateDatalist.datalistWidget").on("updateDatalist.datalistWidget",e.proxy(this,"_resetListCached")).on("remove",function(e){e.originalEvent||o.detroy()}),this._resetListCached(),r.input.form&&(r.input.name||r.input.id)&&e(r.input.form).on("submit.datalistWidget"+r.input.id,function(){if(!e(r.input).hasClass("no-datalist-cache")&&"off"!=o._autocomplete){var t=e.prop(r.input,"value"),n=(r.input.name||r.input.id)+e.prop(r.input,"type");o.storedOptions||(o.storedOptions=f(n)),t&&-1==o.storedOptions.indexOf(t)&&(o.storedOptions.push(t),l(n,o.storedOptions))}}),e(n).on("unload.datalist"+this.id+" beforeunload.datalist"+this.id,function(e){o.destroy(e)})},_resetListCached:function(){var t,r=this;this.needsUpdate=!0,this.lastUpdatedValue=!1,this.lastUnfoundValue="",this.updateTimer||(n.QUnit||(t=e(r.input).is(":focus")&&(e(r.input).hasClass("list-focus")||e.prop(r.input,"value")))?r.updateListOptions(t):r.updateTimer=setTimeout(function(){r.updateListOptions(),r=null,o=1},200+100*o))},updateListOptions:function(n){this.needsUpdate=!1,clearTimeout(this.updateTimer),this.updateTimer=!1,(e(this.input).hasClass("ws-nosearch")||e(this.input).hasClass("search-start"))&&t.error('please use listFilter/data-list-filer configuration with values: "*", "^" or "!"'),this.addMarkElement=s.addMark||e(this.input).hasClass("mark-option-text"),this.listFilter=e(this.input).data("listFilter")||s.listFilter||"*";var r,i,o,u,a,l,v,m=[],g=[],y=[];for(o=e.prop(this.datalist,"options"),u=0,a=o.length;a>u;u++)r=o[u],!r.disabled&&(v=e(r).val())&&(i={value:v.replace(c,"&lt;").replace(h,"&gt;"),label:e.trim(e.attr(r,"label"))||"",className:r.className||"",elem:s.getOptionContent?r:null},i.label&&(i.className+=" has-option-label"),g.push(i.value),y.push(i));for(this.storedOptions||(this.storedOptions=e(this.input).hasClass("no-datalist-cache")||"off"==this._autocomplete?[]:f((this.input.name||this.input.id)+e.prop(this.input,"type"))),this.storedOptions.forEach(function(e){-1==g.indexOf(e)&&y.push({value:e,label:"",className:"stored-suggest",style:""})}),u=0,a=y.length;a>u;u++)l=y[u],m[u]='<li class="'+l.className+'" tabindex="-1" role="listitem">'+this.getOptionContent(l)+"</li>";this.arrayOptions=y,this.popover.contentElement.html('<div class="datalist-box"><ul role="list">'+m.join("\n")+"</ul></div>"),s.datalistCreated&&s.datalistCreated.apply(this),(n||this.popover.isVisible)&&this.showHideOptions()},getOptionContent:function(e){var t;return s.getOptionContent&&(t=s.getOptionContent.apply(this,arguments),null!=t&&(t+='<span class="option-value" style="display: none;">'+e.value+"</span>")),null==t&&(t='<span class="option-value">'+e.value+"</span>",e.label&&(t+=' <span class="option-label">'+e.label+"</span>")),t||""},showHideOptions:function(t){var n=e.prop(this.input,"value").toLowerCase();if(n!==this.lastUpdatedValue){if(this.lastUnfoundValue&&0===n.indexOf(this.lastUnfoundValue))return this.hideList(),i;this.lastUpdatedValue=n;var r=!1,s="^"==this.listFilter,o=e("li",this.shadowList),u=this;n&&"!"!=this.listFilter?this.arrayOptions.forEach(function(t,i){var a,f,l;"lowerValue"in t||(t.lowerValue=t.value.toLowerCase(),t.label&&t.label!=t.value&&(t.lowerLabel=t.label.toLowerCase())),n!=t.lowerValue&&t.lowerLabel!=n&&(f=t.lowerValue.indexOf(n),a=s?!f:-1!==f,a?l="value":t.lowerLabel&&(f=t.lowerLabel.indexOf(n),a=s?!f:-1!==f,l="label")),a?(u.addMark(e(o[i]).removeClass("hidden-item"),t,l,f,n.length),r=!0):e(o[i]).addClass("hidden-item")}):o.length&&(this.removeMark(o.removeClass("hidden-item")),r=!0),this.hasViewableData=r,!t&&r&&(this.popover.isVisible&&"bottom"==this.popover.element.attr("data-vertical")&&this.popover.element.triggerHandler("pospopover"),this.showList()),r?this.lastUnfoundValue=!1:(this.lastUnfoundValue=n,this.hideList())}},otherType:{value:"label",label:"value"},addMark:function(t,n,r,i,s){if(this.addMarkElement){var o=n[r].substr(i,s);o=n[r].replace(o,"<mark>"+o+"</mark>"),e(".option-"+this.otherType[r]+" > mark",t).each(this._replaceMark),e(".option-"+r,t).html(o)}},_replaceMark:function(){var t=e(this).html();e(this).replaceWith(t)},removeMark:function(t){this.addMarkElement&&e("mark",t).each(this._replaceMark)},showList:function(){if(this.popover.isVisible)return!1;if(this.needsUpdate&&this.updateListOptions(),this.showHideOptions(!0),!this.hasViewableData)return!1;var e=this;return e.shadowList.find("li.active-item").removeClass("active-item"),e.popover.show(this.input),!0},hideList:function(){if(!this.popover.isVisible)return!1;var t=this;return this.popover.hide(),t.shadowList.removeClass("datalist-visible list-item-active"),t.index=-1,t.changedValue&&(t.triggeredByDatalist=!0,e(t.input).trigger("input").trigger("change"),t.changedValue=!1,t.triggeredByDatalist=!1),!0},scrollIntoView:function(t){var n,r=e("ul",this.shadowList),s=e("div.datalist-box",this.shadowList),o=t.position();return o.top-=(parseInt(r.css("paddingTop"),10)||0)+(parseInt(r.css("marginTop"),10)||0)+(parseInt(r.css("borderTopWidth"),10)||0),0>o.top?(s.scrollTop(s.scrollTop()+o.top-2),i):(o.top+=t.outerHeight(),n=s.height(),o.top>n&&s.scrollTop(s.scrollTop()+(o.top-n)+2),i)},changeValue:function(t){if(t[0]){var n,r=e("span.option-value",t).text(),i=e.prop(this.input,"value");r!=i&&(e(this.input).prop("value",r).triggerHandler("updateInput"),this.changedValue=!0,(n=e.data(this.input,"wsspinner"))&&n.setInput&&n.setInput(r))}},markItem:function(t,n,r){var i;r=r||e("li:not(.hidden-item)",this.shadowList),r.length&&(0>t?t=r.length-1:t>=r.length&&(t=0),r.removeClass("active-item"),this.shadowList.addClass("list-item-active"),i=r.filter(":eq("+t+")").addClass("active-item"),n&&(this.changeValue(i),this.scrollIntoView(i)),this.index=t)}})});