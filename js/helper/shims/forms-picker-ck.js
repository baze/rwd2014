webshims.register("forms-picker",function(e,t,n,r,i,s){"use strict";var o=t.picker,u=o._actions,a=s,f=function(e){var t=[e.getFullYear(),a.addZero(e.getMonth()+1),a.addZero(e.getDate())];return t.month=t[0]+"-"+t[1],t.date=t[0]+"-"+t[1]+"-"+t[2],t.time=e.getHours()+":"+e.getMinutes(),t["datetime-local"]=t.date+"T"+t.time,t},l=f(new Date),c=function(t){t=e(t||this.activeButton),this.activeButton.attr({tabindex:"-1","aria-selected":"false"}),this.activeButton=t.attr({tabindex:"0","aria-selected":"true"}),this.index=this.buttons.index(this.activeButton[0]),clearTimeout(this.timer),o._genericSetFocus.apply(this,arguments)},h=function(){var t;this.popover.navedInitFocus&&(t=this.popover.navedInitFocus.sel||this.popover.navedInitFocus,this.activeButton&&this.activeButton[0]||!this.buttons[t]?t&&(this.activeButton=e(t,this.element)):this.activeButton=this.buttons[t](),!this.activeButton[0]&&this.popover.navedInitFocus.alt&&(this.activeButton=this.buttons[this.popover.navedInitFocus.alt]())),this.activeButton&&this.activeButton[0]||(this.activeButton=this.buttons.filter(".checked-value")),this.activeButton[0]||(this.activeButton=this.buttons.filter(".this-value")),this.activeButton[0]||(this.activeButton=this.buttons.eq(0)),this.setFocus(this.activeButton,this.opts.noFocus)},p=t.formcfg,d=p[e.webshims.activeLang()]||p[""];e.webshims.activeLang({register:"form-core",callback:function(){e.each(arguments,function(e,t){return p[t]?(d=p[t],!1):i})}}),t.ListBox=function(t,n,r){this.element=e("ul",t),this.popover=n,this.opts=r||{},this.buttons=e("button:not(:disabled)",this.element),this.ons(this),this._initialFocus()},t.ListBox.prototype={setFocus:c,_initialFocus:h,prev:function(){var e=this.index-1;0>e?this.opts.prev&&(this.popover.navedInitFocus="last",this.popover.actionFn(this.opts.prev),this.popover.navedInitFocus=!1):this.setFocus(this.buttons.eq(e))},next:function(){var e=this.index+1;e>=this.buttons.length?this.opts.next&&(this.popover.navedInitFocus="first",this.popover.actionFn(this.opts.next),this.popover.navedInitFocus=!1):this.setFocus(this.buttons.eq(e))},ons:function(e){this.element.on({keydown:function(t){var n,r=t.keyCode;return t.ctrlKey?i:(36==r||33==r?(e.setFocus(e.buttons.eq(0)),n=!0):34==r||35==r?(e.setFocus(e.buttons.eq(e.buttons.length-1)),n=!0):38==r||37==r?(e.prev(),n=!0):(40==r||39==r)&&(e.next(),n=!0),n?!1:i)}})}},t.Grid=function(t,n,r){this.element=e("tbody",t),this.popover=n,this.opts=r||{},this.buttons=e("button:not(:disabled,.othermonth)",this.element),this.ons(this),this._initialFocus(),this.popover.openedByFocus&&(this.popover.activeElement=this.activeButton)},t.Grid.prototype={setFocus:c,_initialFocus:h,first:function(){this.setFocus(this.buttons.eq(0))},last:function(){this.setFocus(this.buttons.eq(this.buttons.length-1))},upPage:function(){e(".ws-picker-header > button:not(:disabled)",this.popover.element).trigger("click")},downPage:function(){this.activeButton.filter(':not([data-action="changeInput"])').trigger("click")},ons:function(e){this.element.on({keydown:function(t){var n,r=t.keyCode;return t.shiftKey?i:(t.ctrlKey&&40==r?n="downPage":t.ctrlKey&&38==r?n="upPage":33==r||t.ctrlKey&&37==r?n="prevPage":34==r||t.ctrlKey&&39==r?n="nextPage":36==t.keyCode||33==t.keyCode?n="first":35==t.keyCode?n="last":38==t.keyCode?n="up":37==t.keyCode?n="prev":40==t.keyCode?n="down":39==t.keyCode&&(n="next"),n?(e[n](),!1):i)}})}},e.each({prevPage:{get:"last",action:"prev"},nextPage:{get:"first",action:"next"}},function(e,n){t.Grid.prototype[e]=function(){this.opts[n.action]&&(this.popover.navedInitFocus={sel:'button[data-id="'+this.activeButton.attr("data-id")+'"]:not(:disabled,.othermonth)',alt:n.get},this.popover.actionFn(this.opts[n.action]),this.popover.navedInitFocus=!1)}}),e.each({up:{traverse:"prevAll",get:"last",action:"prev",reverse:!0},down:{traverse:"nextAll",get:"first",action:"next"}},function(n,r){t.Grid.prototype[n]=function(){var t=this.activeButton.closest("td").prop("cellIndex"),n="td:nth-child("+(t+1)+") button:not(:disabled,.othermonth)",i=this.activeButton.closest("tr")[r.traverse]();r.reverse&&(i=e(i.get().reverse())),i=i.find(n)[r.get](),i[0]?this.setFocus(i.eq(0)):this.opts[r.action]&&(this.popover.navedInitFocus=n+":"+r.get,this.popover.actionFn(this.opts[r.action]),this.popover.navedInitFocus=!1)}}),e.each({prev:{traverse:"prevAll",get:"last",reverse:!0},next:{traverse:"nextAll",get:"first"}},function(n,r){t.Grid.prototype[n]=function(){var t="button:not(:disabled,.othermonth)",i=this.activeButton.closest("td")[r.traverse]("td");r.reverse&&(i=e(i.get().reverse())),i=i.find(t)[r.get](),i[0]||(i=this.activeButton.closest("tr")[r.traverse]("tr"),r.reverse&&(i=e(i.get().reverse())),i=i.find(t)[r.get]()),i[0]?this.setFocus(i.eq(0)):this.opts[n]&&(this.popover.navedInitFocus=r.get,this.popover.actionFn(this.opts[n]),this.popover.navedInitFocus=!1)}}),o.getWeek=function(e){var t,n=new Date(e.getTime());return n.setDate(n.getDate()+4-(n.getDay()||7)),t=n.getTime(),n.setMonth(0),n.setDate(1),Math.floor(Math.round((t-n)/864e5)/7)+1},o.getYearList=function(e,t){var n,r,i,s,u,a,f,c,h,p,d=t.options,v=d.size,m=d.max.split("-"),g=d.min.split("-"),y=d.cols||4,b=d.value.split("-"),w=0,E=0,S="",x=0;for("max"==t.options.useDecadeBase&&m[0]?w=11-m[0]%12:"min"==t.options.useDecadeBase&&g[0]&&(w=11-g[0]%12),e=1*e[0],p=e-(e+w)%(12*v),n=0;v>n;n++){for(n?p+=12:a=o.isInRange([p-1],m,g)?{"data-action":"setYearList",value:p-1}:!1,S+='<div class="year-list picker-list ws-index-'+n+'"><div class="ws-picker-header"><button disabled="disabled">'+p+" – "+(p+11)+"</button></div>",u=[],r=0;12>r;r++)i=p+r,h=[],o.isInRange([i],m,g)?(s="",E++):s=' disabled=""',i==l[0]&&h.push("this-value"),b[0]==i&&h.push("checked-value"),c=h.length?' class="'+h.join(" ")+'"':"",!r||r%y||(x++,u.push('</tr><tr class="ws-row-'+x+'">')),u.push('<td class="ws-item-'+r+'" role="presentation"><button  data-id="year-'+r+'" type="button"'+s+c+' data-action="setMonthList" value="'+i+'" tabindex="-1" role="gridcell">'+i+"</button></td>");n==v-1&&(f=o.isInRange([i+1],m,g)?{"data-action":"setYearList",value:i+1}:!1),S+='<div class="picker-grid"><table role="grid" aria-label="'+p+" – "+(p+11)+'"><tbody><tr class="ws-row-0">'+u.join("")+"</tr></tbody></table></div></div>"}return{enabled:E,main:S,next:f,prev:a,type:"Grid"}},o.getMonthList=function(e,t){var n,r,i,s,u,a,f,c,h,p,v,m=t.options,g=m.size,y=m.max.split("-"),b=m.min.split("-"),w=m.cols||4,E=m.value.split("-"),S=0,x=0,T="";for(e=e[0]-Math.floor((g-1)/2),n=0;g>n;n++){for(n?e++:c=o.isInRange([e-1],y,b)?{"data-action":"setMonthList",value:e-1}:!1,n==g-1&&(h=o.isInRange([e+1],y,b)?{"data-action":"setMonthList",value:e+1}:!1),a=[],o.isInRange([e,"01"],y,b)||o.isInRange([e,"12"],y,b)?(f=!1,u=""):(u=' disabled=""',f=!0),m.minView>=1&&(u=' disabled=""'),T+='<div class="month-list picker-list ws-index-'+n+'"><div class="ws-picker-header">',T+=m.selectNav?'<select data-action="setMonthList" class="year-select">'+o.createYearSelect(e,y,b).join("")+"</select>":'<button data-action="setYearList"'+u+' value="'+e+'" tabindex="-1">'+e+"</button>",T+="</div>",r=0;12>r;r++)s=d.date.monthkeys[r+1],i=(d.date[m.monthNames]||d.date.monthNames)[r],v=[],f||!o.isInRange([e,s],y,b)?u=' disabled=""':(u="",S++),e==l[0]&&l[1]==s&&v.push("this-value"),E[0]==e&&E[1]==s&&v.push("checked-value"),p=v.length?' class="'+v.join(" ")+'"':"",!r||r%w||(x++,a.push('</tr><tr class="ws-row-'+x+'">')),a.push('<td class="ws-item-'+r+'" role="presentation"><button data-id="month-'+r+'" type="button"'+u+p+' data-action="'+("month"==t.type?"changeInput":"setDayList")+'" value="'+e+"-"+s+'" tabindex="-1" role="gridcell" aria-label="'+d.date.monthNames[r]+'">'+i+"</button></td>");T+='<div class="picker-grid"><table role="grid" aria-label="'+e+'"><tbody><tr class="ws-row-0">'+a.join("")+"</tr></tbody></table></div></div>"}return{enabled:S,main:T,prev:c,next:h,type:"Grid"}},o.getDayList=function(t,n){var r,i,s,u,a,c,h,p,v,m,g,y,b,w,E,S,x,T,N,C,k,L=n.options,A=L.size,O=L.max.split("-"),M=L.min.split("-"),_=L.value.split("-"),D=d.date[L.monthNamesHead]||d.date[L.monthNames]||d.date.monthNames,P=[],H=new Date(t[0],t[1]-1,1),B="datetime-local"==n.type?"setTimeList":"changeInput";for(H.setMonth(H.getMonth()-Math.floor((A-1)/2)),L.yearButtons&&(p=[1*t[0]+1,t[1]],p=o.isInRange(p,O,M)?{"data-action":"setDayList",value:p.join("-")}:!1,v=[1*t[0]-1,t[1]],v=o.isInRange(v,O,M)?{"data-action":"setDayList",value:v.join("-")}:!1),r=0;A>r;r++){for(H.setDate(1),b=H.getMonth(),y=0,r||(C=new Date(H.getTime()),C.setDate(-1),S=f(C),c=o.isInRange(S,O,M)?{"data-action":"setDayList",value:S[0]+"-"+S[1]}:!1),S=f(H),P.push('<div class="day-list picker-list ws-index-'+r+'"><div class="ws-picker-header">'),L.selectNav&&(x=['<select data-action="setDayList" class="month-select" tabindex="0">'+o.createMonthSelect(S,O,M,D).join("")+"</select>",'<select data-action="setDayList" class="year-select" tabindex="0">'+o.createYearSelect(S[0],O,M,"-"+S[1]).join("")+"</select>"],d.date.showMonthAfterYear&&x.reverse(),P.push(x.join(" "))),T=[d.date.monthNames[1*S[1]-1],S[0]],x=[D[1*S[1]-1],S[0]],d.date.showMonthAfterYear&&(x.reverse(),T.reverse()),n.options.selectNav||P.push('<button data-action="setMonthList"'+(L.minView>=2?' disabled="" ':"")+' value="'+S.date+'" tabindex="-1">'+x.join(" ")+"</button>"),P.push('</div><div class="picker-grid"><table role="grid" aria-label="'+T.join(" ")+'"><thead><tr>'),n.options.showWeek&&P.push('<th class="week-header">'+d.date.weekHeader+"</th>"),s=d.date.firstDay;d.date.dayNamesShort.length>s;s++)P.push('<th class="day-'+s+'"><abbr title="'+d.date.dayNames[s]+'">'+d.date.dayNamesShort[s]+"</abbr></th>");for(s=d.date.firstDay;s--;)P.push('<th class="day-'+s+'"><abbr title="'+d.date.dayNames[s]+'">'+d.date.dayNamesShort[s]+"</abbr></th>");for(P.push('</tr></thead><tbody><tr class="ws-row-0">'),n.options.showWeek&&(g=o.getWeek(H),P.push('<td class="week-cell">'+g+"</td>")),i=0;99>i;i++){if(m=i&&!(i%7),w=H.getMonth(),E=b!=w,u=H.getDay(),k=[],m&&E){P.push("</tr>");break}m&&(y++,P.push('</tr><tr class="ws-row-'+y+'">'),n.options.showWeek&&(g++,g>52&&(g=o.getWeek(H)),P.push('<td class="week-cell">'+g+"</td>"))),i||u!=d.date.firstDay&&(a=u-d.date.firstDay,0>a&&(a+=7),H.setDate(H.getDate()-a),u=H.getDay(),w=H.getMonth(),E=b!=w),S=f(H),N='<td role="presentation" class="day-'+u+'"><button data-id="day-'+H.getDate()+'" role="gridcell" data-action="'+B+'" value="'+S.join("-")+'" type="button"',E?k.push("othermonth"):k.push("day-"+H.getDate()),S[0]==l[0]&&l[1]==S[1]&&l[2]==S[2]&&k.push("this-value"),_[0]==S[0]&&S[1]==_[1]&&S[2]==_[2]&&k.push("checked-value"),k.length&&(N+=' class="'+k.join(" ")+'"'),(!o.isInRange(S,O,M)||n.options.disableDays&&-1!=e.inArray(u,n.options.disableDays))&&(N+=' disabled=""'),P.push(N+' tabindex="-1">'+H.getDate()+"</button></td>"),H.setDate(H.getDate()+1)}P.push("</tbody></table></div></div>"),r==A-1&&(S=f(H),S[2]=1,h=o.isInRange(S,O,M)?{"data-action":"setDayList",value:S.date}:!1)}return{enabled:9,main:P.join(""),prev:c,next:h,yearPrev:v,yearNext:p,type:"Grid"}},o.getTimeList=function(t,n){var r,i,s,o,u,f='<div class="time-list picker-list ws-index-0">',l=0,c=0,h=23,p={min:e.prop(n.orig,"min"),max:e.prop(n.orig,"max"),step:e.prop(n.orig,"step")},v=n.options,m=d.date[v.monthNamesHead]||d.date[v.monthNames]||d.date.monthNames,g="";for("time"==n.type?r='<button type="button" disabled="">'+e.trim(e(n.orig).jProp("labels").text()||"").replace(/[\:\*]/g,"")+"</button>":(i=t[2].split("T"),t[2]=i[0],i[1]&&(t[3]=i[1]),r=t[2]+". "+m[1*t[1]-1]+" "+t[0],g=' aria-label="'+r+'"',r='<button tabindex="-1" data-action="setDayList" value="'+t[0]+"-"+t[1]+"-"+t[2]+'" type="button">'+r+"</button>",u=t[0]+"-"+t[1]+"-"+t[2]+"T"),f+='<div class="ws-picker-header">'+r+"</div>",f+='<div class="picker-grid"><table role="grid"'+g+"><tbody><tr>";h>=l;l++)s=a.addZero(""+l)+":00",o=u?u+s:s,!l||l%4||(c++,f+='</tr><tr class="ws-row-'+c+'">'),f+='<td role="presentation"><button role="gridcell" data-action="changeInput" value="'+o+'" type="button" tabindex="-1"',n.isValid(o,p)||(f+=' disabled=""'),t==s&&(f+=' class="checked-value"'),f+=">"+n.formatValue(s)+"</button></td>";return f+="</tr></tbody></table></div></div>",{enabled:9,main:f,prev:!1,next:!1,type:"Grid"}},o.isInRange=function(e,t,n){var r,i=!0;for(r=0;e.length>r;r++){if(n[r]&&n[r]>e[r]){i=!1;break}if(!n[r]||n[r]!=e[r])break}if(i)for(r=0;e.length>r;r++){if(t[r]&&t[r]<e[r]){i=!1;break}if(!t[r]||t[r]!=e[r])break}return i},o.createMonthSelect=function(e,t,n,r){r||(r=d.date.monthNames);for(var i,s=0,u=[],f=e[1]-1;r.length>s;s++)i=f==s?' selected=""':"",(i||o.isInRange([e[0],s+1],t,n))&&u.push('<option value="'+e[0]+"-"+a.addZero(s+1)+'"'+i+">"+r[s]+"</option>");return u},o.createYearSelect=function(e,t,n,r){var i,s=!0,u=!0,a=['<option selected="">'+e+"</option>"],f=0;for(r||(r="");8>f&&(s||u);)f++,i=e-f,s&&o.isInRange([i],t,n)?a.unshift('<option value="'+(i+r)+'">'+i+"</option>"):s=!1,i=e+f,u&&o.isInRange([i],t,n)?a.push('<option value="'+(i+r)+'">'+i+"</option>"):u=!1;return a},function(){var n=function(e){return"get"+e+"List"},r=function(e){return"set"+e+"List"},i={date:"Day",week:"Day",month:"Month","datetime-local":"Time",time:"Time"},s=function(e,t,n){e[n]?t[n+"Element"].attr(e[n]).prop({disabled:!1}):t[n+"Element"].removeAttr("data-action").prop({disabled:!0})};e.each({setYearList:["Year","Month","Day","Time"],setMonthList:["Month","Day","Time"],setDayList:["Day","Time"],setTimeList:["Time"]},function(a,f){var l=f.map(n),c=f.map(r);u[a]=function(n,r,u,a){n=""+n;var h=u.options,p=n.split("-");a||(a=0),e.each(l,function(e,n){if(e>=a){var l=o[n](p,u);if(2>p.length||l.enabled>1||i[u.type]===f[e])return r.element.attr({"data-currentview":c[e]}).addClass("ws-size-"+h.size).data("pickercontent",{data:u,content:l,values:p}),r.bodyElement.html(l.main),s(l,r,"prev"),s(l,r,"next"),h.yearButtons&&(s(l,r,"yearPrev"),s(l,r,"yearNext")),t[l.type]&&new t[l.type](r.bodyElement.children(),r,l),r.element.trigger("pickerchange").filter('[data-vertical="bottom"]').triggerHandler("pospopover"),!1}})}})}(),o.showPickerContent=function(e,t){var n=e.options;e._popoverinit||(o.commonInit(e,t),o.commonDateInit(e,t)),!e._popoverinit||n.restartView?u.setYearList(n.defValue||n.value,t,e,n.startView):u[t.element.attr("data-currentview")||"setYearList"](n.defValue||n.value,t,e,0),e._popoverinit=!0},o.commonDateInit=function(n,i){var s=function(){return e(this).is(".othermonth")&&"pointer"!=e(this).css("cursor")||i.actionFn({"data-action":e.attr(this,"data-action"),value:e(this).val()||e.attr(this,"value")}),!1},a=(new Date).getTime(),f=function(r){var s=[],u="",f="";r.options=n.getOptions()||{},e("div.ws-options",i.contentElement).remove(),e.each(r.options[0],function(e,t){var i=o.isInRange(e.split("-"),r.maxS,r.minS)?"":' disabled="" ';t&&(t=' <span class="ws-label">'+t+"</span>"),s.push('<li role="presentation"><button value="'+e+'" '+i+' data-action="changeInput" tabindex="-1"  role="option"><span class="ws-value">'+n.formatValue(e,!1)+"</span>"+t+"</button></li>")}),s.length&&(a++,r.options[1]&&(f="datalist-"+a,u='<h5 id="'+f+'">'+r.options[1]+"</h5>",f=' aria-labelledbyid="'+f+'" '),new t.ListBox(e('<div class="ws-options">'+u+'<ul role="listbox" '+f+">"+s.join("")+"</div>").insertAfter(i.bodyElement)[0],i,{noFocus:!0}))},c=function(){if(i.isDirty){var r=n.options;r.maxS=r.max.split("-"),r.minS=r.min.split("-"),e("button",i.buttonRow).each(function(){var i;e(this).is(".ws-empty")?(i=d.date.clear,i||(i=p[""].date.clear||"clear",t.warn("could not get clear text from form cfg"))):e(this).is(".ws-current")&&(i=(d[n.type]||{}).currentText,i||(i=(p[""][[n.type]]||{}).currentText||(d.date||{}).currentText||"current",t.warn("could not get currentText from form cfg for "+n.type)),l[n.type]&&"time"!=n.type&&e.prop(this,"disabled",!o.isInRange(l[n.type].split("-"),r.maxS,r.minS))),i&&(e(this).text(i).attr({"aria-label":i}),t.assumeARIA&&e.attr(this,"aria-label",i))}),i.nextElement.attr({"aria-label":d.date.nextText}).find("span").html(d.date.nextText),i.prevElement.attr({"aria-label":d.date.prevText}).find("span").html(d.date.prevText),r.yearButtons&&(i.yearNextElement.attr({"aria-label":d.date.nextText}).find("span").html(d.date.nextText),i.yearPrevElement.attr({"aria-label":d.date.prevText}).find("span").html(d.date.prevText)),f(r,r.maxS,r.minS),i.isVisible&&o.showPickerContent(n,i)}e("button.ws-empty",i.buttonRow).prop("disabled",e.prop(n.orig,"required")),i.isDirty=!1};i.actionFn=function(e){u[e["data-action"]]?u[e["data-action"]](e.value,i,n,0):t.warn("no action for "+e["data-action"])},i.contentElement.html('<button class="ws-prev" tabindex="0"><span></span></button> <button class="ws-next" tabindex="0"><span></span></button><div class="ws-picker-body"></div><div class="ws-button-row"><button type="button" class="ws-current" data-action="changeInput" value="'+l[n.type]+'" tabindex="0"></button> <button type="button" data-action="changeInput" value="" class="ws-empty" tabindex="0"></button></div>'),i.nextElement=e("button.ws-next",i.contentElement),i.prevElement=e("button.ws-prev",i.contentElement),i.bodyElement=e("div.ws-picker-body",i.contentElement),i.buttonRow=e("div.ws-button-row",i.contentElement),i.element.on("updatepickercontent",c),n.options.yearButtons&&(i.element.addClass("ws-year-buttons"),i.yearNextElement=e('<button class="ws-super-next" tabindex="0"><span></span></button>').insertAfter(i.nextElement),i.yearPrevElement=e('<button class="ws-super-prev" tabindex="0"><span></span></button>').insertBefore(i.prevElement)),i.contentElement.on("click","button[data-action]",s).on("change","select[data-action]",s),n.options.inlinePicker&&(n.options.updateOnInput=!0),e(n.options.orig).on("input",function(){var e;n.options.updateOnInput&&i.isVisible&&n.options.value&&(e=i.element.attr("data-currentview"))&&u[e](n.options.value,i,n,0)}),e(r).onTrigger("wslocalechange",n._propertyChange)}});