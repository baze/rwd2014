(function(e){if(!navigator.geolocation){var t=function(){setTimeout(function(){throw"document.write is overwritten by geolocation shim. This method is incompatible with this plugin"},1)},n=0,r=webshims.cfg.geolocation||{};navigator.geolocation=function(){var s,o={getCurrentPosition:function(n,i,o){var u,f,l,c=2,h=function(){if(!l)if(s){if(l=!0,n(e.extend({timestamp:(new Date).getTime()},s)),d(),window.JSON&&window.sessionStorage)try{sessionStorage.setItem("storedGeolocationData654321",JSON.stringify(s))}catch(t){}}else i&&!c&&(l=!0,d(),i({code:2,message:"POSITION_UNAVAILABLE"}))},p=function(){c--,v(),h()},d=function(){e(document).unbind("google-loader",d),clearTimeout(f),clearTimeout(u)},v=function(){if(s||!window.google||!google.loader||!google.loader.ClientLocation)return!1;var t=google.loader.ClientLocation;return s={coords:{latitude:t.latitude,longitude:t.longitude,altitude:null,accuracy:43e3,altitudeAccuracy:null,heading:parseInt("NaN",10),velocity:null},address:e.extend({streetNumber:"",street:"",premises:"",county:"",postalCode:""},t.address)},!0},m=function(){if(!s&&(v(),!s&&window.JSON&&window.sessionStorage))try{s=sessionStorage.getItem("storedGeolocationData654321"),s=s?JSON.parse(s):!1,s.coords||(s=!1)}catch(e){s=!1}};return m(),s?(setTimeout(h,1),void 0):r.confirmText&&!confirm(r.confirmText.replace("{location}",location.hostname))?(i&&i({code:1,message:"PERMISSION_DENIED"}),void 0):(e.ajax({url:"http://freegeoip.net/json/",dataType:"jsonp",cache:!0,jsonp:"callback",success:function(e){c--,e&&(s=s||{coords:{latitude:e.latitude,longitude:e.longitude,altitude:null,accuracy:43e3,altitudeAccuracy:null,heading:parseInt("NaN",10),velocity:null},address:{city:e.city,country:e.country_name,countryCode:e.country_code,county:"",postalCode:e.zipcode,premises:"",region:e.region_name,street:"",streetNumber:""}},h())},error:function(){c--,h()}}),clearTimeout(f),window.google&&window.google.loader?c--:f=setTimeout(function(){r.destroyWrite&&(document.write=t,document.writeln=t),e(document).one("google-loader",p),webshims.loader.loadScript("http://www.google.com/jsapi",!1,"google-loader")},800),u=o&&o.timeout?setTimeout(function(){d(),i&&i({code:3,message:"TIMEOUT"})},o.timeout):setTimeout(function(){c=0,h()},1e4),void 0)},clearWatch:e.noop};return o.watchPosition=function(e,t,r){return o.getCurrentPosition(e,t,r),n++,n},o}(),webshims.isReady("geolocation",!0)}})(webshims.$);